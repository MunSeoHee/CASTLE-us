<!-- 댓글 수 가져오기 -->
{%extends 'base.html'%}
{%block contents%}
{%load static%}
<link rel="stylesheet" href="{%static 'groupPurchase_detail.css'%}">
<div class="container">
    <!-- detail-body -->
    <div class="detail-body">
        <!-- detail-info -->
        <div class="detail-info">
            {%if groupPurchase.proceeding == 1 %}
                <span class="process">진행중</span>
            {%else%}
                <span class="process">진행종료</span>
            {%endif%}
            <br>
            {%if groupPurchase.category == 1%}
                <span class="proceeding">가구</span>
            {%elif groupPurchase.category == 2%}
                <span class="proceeding">침구</span>
            {%elif groupPurchase.category == 3%}
                <span class="proceeding">패브릭</span>
            {%elif groupPurchase.category == 4%}
                <span class="proceeding">조명</span>
            {%elif groupPurchase.category == 5%}
                <span class="proceeding">홈데코</span>
            {%elif groupPurchase.category == 6%}
                <span class="proceeding">가전</span>
            {%elif groupPurchase.category == 7%}
                <span class="proceeding">수납/정리</span>
            {%elif groupPurchase.category == 8%}
                <span class="proceeding">생활용품</span>
            {%elif groupPurchase.category == 9%}
                <span class="proceeding">주방</span>
            {%elif groupPurchase.category == 10%}
                <span class="proceeding">DIY/공구</span>
            {%elif groupPurchase.category == 11%}
                <span class="proceeding">인테리어</span>
            {%else%}
                <span class="proceeding">반려동물</span>
            {%endif%}


            <h1 class="detail-title">{{groupPurchase.title}}</h1>

            {%for i in user_info%}
                {%if i.user_id == groupPurchase.writer%}
                <span class="user">{{i.nickname}}</span>
                {%endif%}
            {%endfor%}

            <span class="time"><i class="far fa-clock"></i>{{groupPurchase.date}}</span>
        </div>
        <!-- carousel -->
        <div id="carouselExampleIndicators" class="carousel slide" data-ride="carousel">
            <ol class="carousel-indicators">
                <li data-target="#carouselExampleIndicators" data-slide-to="0" class="active"></li>
                <li data-target="#carouselExampleIndicators" data-slide-to="1"></li>
                <li data-target="#carouselExampleIndicators" data-slide-to="2"></li>
            </ol>
            <div class="carousel-inner">
                <div class="carousel-item active">
                    <img src="../media/{{groupPurchase.img}}" class="d-block w-100" alt="...">
                </div>
                <div class="carousel-item">
                    <img src="../media/{{groupPurchase.img}}" class="d-block w-100" alt="...">
                </div>
                <div class="carousel-item">
                    <img src="../media/{{groupPurchase.img}}" class="d-block w-100" alt="...">
                </div>
            </div>
            <a class="carousel-control-prev" href="#carouselExampleIndicators" role="button" data-slide="prev">
                <span class="carousel-control-prev-icon" aria-hidden="true"></span>
                <span class="sr-only">Previous</span>
            </a>
            <a class="carousel-control-next" href="#carouselExampleIndicators" role="button" data-slide="next">
                <span class="carousel-control-next-icon" aria-hidden="true"></span>
                <span class="sr-only">Next</span>
            </a>
        </div>
        <!-- detail-content -->
        <p class="detail-content">
            {{groupPurchase.contents|safe}}
        </p>
    </div>
</div>
<div class="container container2">
    <!-- comments-part -->
    <div class="comments-part">
        <div class="comments-head">
            <h1 class="comments-title">댓글</h1>
            
            <span class="count-comments">{{count}}</span>
            
        </div>
        <div class="input-comment">
            <i class="far fa-grin"></i>
            <form class="input-group" method="GET" id="createComment" action ="{%url 'groupPurchase_comment_new'%}">
                <input class="form-control" type="text" placeholder="댓글을 남겨 보세요." name="contents">
                <input type="text" value = "{{groupPurchase.id}}" name="groupPurchase_id" style="display: none;">
                <button type="submit" class="btn saveBtn" form="createComment">등록</button>
            </form>
        </div>
        {%for i in allComments.all%}
            {%if i.Group_buying_id == groupPurchase.id%}
            <div class="comment">
                <img src="../media/images/smile.png" alt="user-image" class="user-image">
                <div class="comment-name-content" style="display: block; width: 100%">

                    {%for j in user_info.all%}
                        {%if i.user_info_id == j.id%}
                            <h4 class="comment-name">{{j.nickname}}</h4>
                        {%endif%}
                    {%endfor%}


                    <p class="comment-content">
                        {{i.contents}}
                    </p>
                    <div class="comment-etc">
                        <span class="write-time">{{groupPurchase.date}}</span>
                        <div class="comment-etc2">
                            <span class="like"><a><i class="fas fa-heart"></i>좋아요</a></span>
                        <span class="create-comments"><a>답글 달기</a></span>
                        <span class="report"><a>신고</a></span>
                        </div>
                    </div>
                    <div class="user-comment-add" style="margin: 1rem 0;">
                        <form class="input-group" method="GET" id="createComment2">
                            <i class="far fa-arrow-alt-circle-right"></i>
                            <input class="form-control" type="text" placeholder="댓글을 남겨 보세요." name="contents">
                            <button type="submit" class="btn saveBtn" form="createComment2">등록</button>
                        </form>
                    </div>
                </div>
            </div>
            {%endif%}
        {%endfor%}
    </div>
</div>
<script>
    const heart = document.querySelectorAll('.fa-heart');
        const like = document.querySelectorAll('.like');
        for(let i =0; i < like.length; i++){
            like[i].addEventListener('click', (e)=>{
                e.target.classList.toggle('toggle-like');
            })};

    const userCommentAdd = document.querySelectorAll('.user-comment-add');
    const createComment = document.querySelectorAll('.create-comments');
    for(let i=0; i< createComment.length; i++){
        console.log(createComment[i]);
        createComment[i].addEventListener('click', () => {
            userCommentAdd[i].classList.toggle('openComment');
        })
    }
</script>
{%endblock%}